<!-- Thrive Login Auth Component Template Part -->
<!-- Contains the login trigger button and the modal markup plus inline JS for behavior. -->
<div class="thrive-auth-component" data-thrive-auth>
    <button id="thrive-login-button" class="thrive-login-button" type="button" aria-haspopup="dialog" aria-controls="thrive-login-modal">Login</button>

    <div id="thrive-login-modal" class="thrive-login-modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="thrive-login-title">
        <div class="thrive-login-modal__backdrop" data-close-modal></div>
        <div class="thrive-login-modal__dialog" role="document">
            <button class="thrive-login-modal__close" type="button" aria-label="Close" data-close-modal>&times;</button>
            <h2 id="thrive-login-title">Sign In</h2>
            <p class="thrive-login-modal__subtitle">Choose a sign-in method</p>
            <div class="thrive-login-modal__actions">
                <button id="thrive-google-login" class="thrive-login-provider thrive-login-provider--google" type="button">
                    <span class="thrive-login-provider__icon" aria-hidden="true">G</span>
                    <span>Continue with Google</span>
                </button>
                <!-- Future: Email/password form could be injected here -->
            </div>
            <p class="thrive-login-modal__disclaimer">By continuing you agree to our <a href="#" rel="noopener">Terms</a> &amp; <a href="#" rel="noopener">Privacy Policy</a>.</p>
        </div>
    </div>
</div>

<!-- Inline, self-contained script (guarded to avoid duplicate init) -->
<script id="thrive-login-auth-script">(function(){
  if (window.__THRIVE_LOGIN_AUTH_INITIALIZED__) return; // guard if part included multiple times
  window.__THRIVE_LOGIN_AUTH_INITIALIZED__ = true;

  // Provide config if not already set (allows server-side override later)
  window.ThriveAuthConfig = window.ThriveAuthConfig || { googleAuthUrl: 'http://localhost:8080/api/auth/google' };

  const qs = (sel, ctx=document)=>ctx.querySelector(sel);
  const qa = (sel, ctx=document)=>Array.from(ctx.querySelectorAll(sel));

  function trapFocus(modal){
    const focusable = qa('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])', modal).filter(el=>!el.hasAttribute('disabled'));
    if(!focusable.length) return;
    const [first] = focusable; const last = focusable[focusable.length-1];
    function handler(e){
      if(e.key==='Tab'){
        if(e.shiftKey && document.activeElement===first){e.preventDefault();last.focus();}
        else if(!e.shiftKey && document.activeElement===last){e.preventDefault();first.focus();}
      } else if(e.key==='Escape'){ close(); }
    }
    modal.addEventListener('keydown', handler);
    first.focus();
  }

  function open(){
    const modal = qs('#thrive-login-modal'); if(!modal) return;
    modal.setAttribute('aria-hidden','false');
    modal.classList.add('is-open');
    document.body.classList.add('thrive-modal-open');
    trapFocus(modal);
  }
  function close(){
    const modal = qs('#thrive-login-modal'); if(!modal) return;
    modal.setAttribute('aria-hidden','true');
    modal.classList.remove('is-open');
    document.body.classList.remove('thrive-modal-open');
    const trigger = qs('#thrive-login-button'); if(trigger) trigger.focus();
  }

  function init(){
    const trigger = qs('#thrive-login-button'); const modal = qs('#thrive-login-modal'); if(!trigger||!modal) return;
    trigger.addEventListener('click', open);
    qa('[data-close-modal]', modal).forEach(btn=>btn.addEventListener('click', close));
    modal.addEventListener('click', e=>{ if(e.target===modal) close(); });
    const googleBtn = qs('#thrive-google-login');
    if(googleBtn){ googleBtn.addEventListener('click', ()=>{ const cfg = window.ThriveAuthConfig||{}; if(cfg.googleAuthUrl) { window.location.href = cfg.googleAuthUrl; } else { console.error('Google auth URL missing'); } }); }
  }
  document.addEventListener('DOMContentLoaded', init);
})();</script>
